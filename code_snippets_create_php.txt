=============================================================================
CODE SNIPPETS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå create.php
=============================================================================

=============================================================================
SNIPPET 1: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ü‡∏¥‡∏•‡∏î‡πå package (‡πÅ‡∏ó‡∏£‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 294)
=============================================================================

// üÜï ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏à‡∏∏
$package_qty = !empty($_POST['package_qty'][$i]) ? floatval($_POST['package_qty'][$i]) : null;
$package_unit_id = !empty($_POST['package_unit_id'][$i]) ? intval($_POST['package_unit_id'][$i]) : null;
$qty_per_package = !empty($_POST['qty_per_package'][$i]) ? floatval($_POST['qty_per_package'][$i]) : null;

// üÜï Validate: ‡∏ñ‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ü‡∏¥‡∏•‡∏î‡πå package ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á 3 ‡∏ü‡∏¥‡∏•‡∏î‡πå
if (($package_qty !== null || $package_unit_id !== null || $qty_per_package !== null) &&
    ($package_qty === null || $package_unit_id === null || $qty_per_package === null)) {
    throw new Exception("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏à‡∏∏‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô, ‡∏´‡∏ô‡πà‡∏ß‡∏¢, ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢)");
}

// üÜï Validate: package_qty √ó qty_per_package ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö quantity
if ($package_qty !== null && $qty_per_package !== null) {
    $calculated_qty = $package_qty * $qty_per_package;
    if (abs($calculated_qty - $quantity) > 0.01) { // ‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏ú‡∏¥‡∏î‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô 0.01
        throw new Exception("‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏ß‡∏°‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á √ó ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ï‡πà‡∏≠‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á)");
    }
}

=============================================================================
SNIPPET 2: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç SQL INSERT (‡πÅ‡∏ó‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 297-302)
=============================================================================

$stmt = $conn->prepare("
    INSERT INTO PO_Items
    (po_id, line_number, product_id, quantity, purchase_unit_id, stock_unit_id,
     conversion_factor, stock_quantity, unit_price, total_price, item_type_id, status, notes,
     package_qty, package_unit_id, qty_per_package)
    VALUES (?, ?, ?, ?, ?, ?, 1.0, ?, ?, ?, ?, 'Open', ?, ?, ?, ?)
");

=============================================================================
SNIPPET 3: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Execute Parameters (‡πÅ‡∏ó‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 304-307)
=============================================================================

$stmt->execute([
    $po_id, $line_number, $product_id, $quantity, $purchase_unit_id, $purchase_unit_id,
    $quantity, $unit_price, $total_price, $item_type_id_material, $notes_item,
    $package_qty, $package_unit_id, $qty_per_package
]);

=============================================================================
SNIPPET 4: HTML Table Header (‡πÅ‡∏ó‡∏ô <thead> ‡∏Ç‡∏≠‡∏á Material Items Table)
=============================================================================

<thead>
    <tr>
        <th style="width: 22%;">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
        <th style="width: 8%;">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏ß‡∏°</th>
        <th style="width: 8%;">‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
        <th style="width: 7%;" class="text-center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏£‡∏£‡∏à‡∏∏ üÜï</th>
        <th style="width: 8%;" class="text-center">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏à‡∏∏ üÜï</th>
        <th style="width: 7%;" class="text-center">‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ üÜï</th>
        <th style="width: 10%;">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
        <th style="width: 10%;">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th>
        <th style="width: 14%;">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
        <th style="width: 6%;"></th>
    </tr>
</thead>

=============================================================================
SNIPPET 5: HTML Table Row - ‡∏ü‡∏¥‡∏•‡∏î‡πå package ‡πÉ‡∏´‡∏°‡πà (‡πÅ‡∏ó‡∏£‡∏Å‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á purchase_unit ‡πÅ‡∏•‡∏∞ unit_price)
=============================================================================

<!-- üÜï ‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏´‡∏°‡πà: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏£‡∏£‡∏à‡∏∏ -->
<td><input type="number" name="package_qty[]" step="0.01" placeholder="0" class="form-control text-end package-qty-field"></td>

<!-- üÜï ‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏´‡∏°‡πà: ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏à‡∏∏ -->
<td>
    <select name="package_unit_id[]" class="form-select package-unit-field">
        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
        <?php
        // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏à‡∏∏
        $package_units = array_filter($units, function($u) {
            return in_array($u['unit_code'], ['CAN', 'DRUM', 'PAIL', 'BUCKET', 'CARTON', 'BOX', 'ROLL', 'REEL', 'SPOOL', 'BAG', 'SACK', 'BUNDLE', 'PACK', 'BOTTLE']);
        });
        foreach ($package_units as $unit):
        ?>
        <option value="<?= htmlspecialchars($unit['unit_id']) ?>"
                data-symbol="<?= htmlspecialchars($unit['unit_symbol']) ?>">
            <?= htmlspecialchars($unit['unit_name_th'] ?? $unit['unit_name']) ?>
        </option>
        <?php endforeach; ?>
    </select>
</td>

<!-- üÜï ‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏´‡∏°‡πà: ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏à‡∏∏ -->
<td><input type="number" name="qty_per_package[]" step="0.01" placeholder="0" class="form-control text-end qty-per-package-field"></td>

=============================================================================
SNIPPET 6: JavaScript Auto-calculate (‡πÅ‡∏ó‡∏£‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 1549 ‡πÉ‡∏ô addMaterialRowListeners)
=============================================================================

// üÜï Package calculation listeners
const packageQtyField = row.querySelector('.package-qty-field');
const qtyPerPackageField = row.querySelector('.qty-per-package-field');

if (packageQtyField && qtyPerPackageField) {
    // Auto-calculate total quantity when package fields change
    const autoCalcQuantity = () => {
        const packageQty = parseFloat(packageQtyField.value) || 0;
        const qtyPerPkg = parseFloat(qtyPerPackageField.value) || 0;

        if (packageQty > 0 && qtyPerPkg > 0) {
            const totalQty = packageQty * qtyPerPkg;
            quantityField.value = totalQty.toFixed(3);
            updateRowTotal(row);

            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            quantityField.style.backgroundColor = '#d4edda';
        } else {
            quantityField.style.backgroundColor = '';
        }
    };

    packageQtyField.addEventListener('input', autoCalcQuantity);
    qtyPerPackageField.addEventListener('input', autoCalcQuantity);

    // Validate: ‡∏ñ‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å quantity ‡πÄ‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    quantityField.addEventListener('blur', () => {
        const packageQty = parseFloat(packageQtyField.value) || 0;
        const qtyPerPkg = parseFloat(qtyPerPackageField.value) || 0;
        const manualQty = parseFloat(quantityField.value) || 0;

        if (packageQty > 0 && qtyPerPkg > 0) {
            const calculatedQty = packageQty * qtyPerPkg;
            if (Math.abs(calculatedQty - manualQty) > 0.01) {
                alert(`‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏ß‡∏°‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì\n` +
                      `${packageQty} √ó ${qtyPerPkg} = ${calculatedQty.toFixed(3)}\n` +
                      `‡πÅ‡∏ï‡πà‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏£‡∏≠‡∏Å: ${manualQty}`);
                quantityField.style.backgroundColor = '#f8d7da';
            } else {
                quantityField.style.backgroundColor = '#d4edda';
            }
        }
    });
}

=============================================================================
SNIPPET 7: Alert/‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ (‡πÅ‡∏ó‡∏£‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á Material Items ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î 960)
=============================================================================

<div class="alert alert-info mb-3">
    <h6 class="mb-2"><i class="fas fa-info-circle"></i> ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏à‡∏∏</h6>
    <small>
        <strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong> ‡∏™‡∏±‡πà‡∏á‡∏´‡∏°‡∏∂‡∏Å 5 ‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á ‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á‡∏•‡∏∞ 2 ‡∏Å‡∏¥‡πÇ‡∏• ‡∏£‡∏ß‡∏° 10 ‡∏Å‡∏¥‡πÇ‡∏•<br>
        ‚Ä¢ <strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏£‡∏£‡∏à‡∏∏:</strong> 5<br>
        ‚Ä¢ <strong>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏à‡∏∏:</strong> ‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á<br>
        ‚Ä¢ <strong>‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢:</strong> 2<br>
        ‚Ä¢ <strong>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏ß‡∏°:</strong> 10 (‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ = 5 √ó 2)<br>
        <span class="text-muted">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏£‡∏à‡∏∏ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡πâ‡∏≤‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ</span>
    </small>
</div>

=============================================================================
SNIPPET 8: ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° class ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏ü‡∏¥‡∏•‡∏î‡πå quantity (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç <td> ‡∏Ç‡∏≠‡∏á quantity)
=============================================================================

<!-- ‡πÄ‡∏î‡∏¥‡∏° -->
<td><input type="number" name="quantity[]" step="0.01" required placeholder="0.00" class="form-control"></td>

<!-- ‡πÉ‡∏´‡∏°‡πà - ‡πÄ‡∏û‡∏¥‡πà‡∏° class "quantity-field" -->
<td><input type="number" name="quantity[]" step="0.01" required placeholder="0.00" class="form-control quantity-field"></td>

=============================================================================
‡∏à‡∏ö CODE SNIPPETS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö create.php
=============================================================================
